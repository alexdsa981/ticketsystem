<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head th:insert="~{common/imports :: headImports}">
    <title th:text="${titulo}">HelpDesk | Ticket</title>
</head>

<body>
<header th:replace="~{common/header :: header}"></header>







<div class="container">
    <!-- Encabezado del ticket -->
    <div class="d-flex justify-content-between align-items-center">
        <h2 class="text-primary">
            <i class="bi bi-envelope text-info"></i>
            Ticket Código: <span th:text="${ticket.codigoTicket}">TK-0000</span>
        </h2>
    </div>

    <!-- Fila de cards -->
    <div class="row g-4">
        <!-- Card 1 - Envío (Siempre visible) -->
        <div class="col-md-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title mb-3">Datos de Envío</h5>
                    <p class="mb-1"><i class="bi bi-chat-left-text"></i> <span th:text="${ticket.descripcion}">Descripción</span></p>
                    <p class="mb-1"><i class="bi bi-person"></i> <span th:text="${ticket.usuario.nombre}">Usuario</span></p>
                    <p class="mb-1"><i class="bi bi-calendar"></i> <span th:text="${ticket.fechaFormateada}">Fecha</span> <span th:text="${ticket.horaFormateada}">Hora</span></p>
                    <p class="mb-0"><i class="bi bi-tag"></i> <span th:text="${ticket.faseTicket.nombre}">Fase</span></p>
                </div>
            </div>
        </div>

        <!-- Cards visibles si NO está desestimado -->
        <div th:if="${!#strings.equals(ticket.faseTicket.nombre, 'Desestimado')}" class="col-md-8">
            <div class="row g-4">
                <!-- Card 2 - Recepción -->
                <div class="col-md-6">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title mb-3">Datos de Recepción</h5>
                            <div th:if="${#strings.equals(ticket.faseTicket.nombre, 'Enviado')}">
                                <p class="text-muted">Aún no hay recepción.</p>
                            </div>
                            <div th:if="${#strings.equals(ticket.faseTicket.nombre, 'Recepcionado - En Proceso') or #strings.equals(ticket.faseTicket.nombre, 'Cerrado - Atendido')}">
                                <p class="mb-1"><i class="bi bi-chat-left-text"></i> <span th:text="${ticket.descripcion}">Descripción</span></p>
                                <p class="mb-1"><i class="bi bi-person"></i> <span th:text="${ticket.usuario.nombre}">Usuario</span></p>
                                <p class="mb-1"><i class="bi bi-calendar"></i> <span th:text="${ticket.fechaFormateada}">Fecha</span> <span th:text="${ticket.horaFormateada}">Hora</span></p>
                                <p class="mb-0"><i class="bi bi-tag"></i> <span>Recepcionado</span></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Card 3 - Atención -->
                <div class="col-md-6">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title mb-3">Datos de Atención</h5>
                            <div th:if="${#strings.equals(ticket.faseTicket.nombre, 'Cerrado - Atendido')}">
                                <p class="mb-1"><i class="bi bi-chat-left-text"></i> <span th:text="${ticket.descripcion}">Descripción</span></p>
                                <p class="mb-1"><i class="bi bi-person"></i> <span th:text="${ticket.usuario.nombre}">Usuario</span></p>
                                <p class="mb-1"><i class="bi bi-calendar"></i> <span th:text="${ticket.fechaFormateada}">Fecha</span> <span th:text="${ticket.horaFormateada}">Hora</span></p>
                                <p class="mb-0"><i class="bi bi-tag"></i> <span>Atendido</span></p>
                            </div>
                            <div th:if="${!#strings.equals(ticket.faseTicket.nombre, 'Cerrado - Atendido')}">
                                <p class="text-muted">Aún no se ha atendido el ticket.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Card 4 - Desestimación (Solo si está desestimado) -->
        <div class="col-md-4" th:if="${#strings.equals(ticket.faseTicket.nombre, 'Desestimado')}">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title mb-3">Datos de Desestimación</h5>
                    <p class="mb-1"><i class="bi bi-chat-left-text"></i> <span th:text="${ticket.descripcion}">Descripción</span></p>
                    <p class="mb-1"><i class="bi bi-person"></i> <span th:text="${ticket.usuario.nombre}">Usuario</span></p>
                    <p class="mb-1"><i class="bi bi-calendar"></i> <span th:text="${ticket.fechaFormateada}">Fecha</span> <span th:text="${ticket.horaFormateada}">Hora</span></p>
                    <p class="mb-0"><i class="bi bi-tag"></i> <span>Desestimado</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Botón de redirección -->
    <div class="text-center mt-4">
        <a class="btn btn-outline-primary"
           th:href="@{${#strings.equals(ticket.faseTicket.nombre, 'Enviado') ? '/soporte/Recepcionar' :
                      (#strings.equals(ticket.faseTicket.nombre, 'Recepcionado - En Proceso') ? '/soporte/Atender' :
                      (#strings.equals(ticket.faseTicket.nombre, 'Cerrado - Atendido') ? '/soporte/Tickets-Cerrados' :
                      '/soporte/Tickets-Desestimados'))}}">
            Ir a la página del ticket
        </a>
    </div>
</div>






<div th:insert="~{common/imports :: bodyImportsAndNotification}"></div>
</body>
</html>
